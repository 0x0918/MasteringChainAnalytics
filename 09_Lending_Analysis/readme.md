# 借贷协议数据分析

## 背景知识
去中心化金融（DeFi）是区块链的金融创新。通过各协议之间的可组合性、互操作性，DeFi乐高就此诞生。2020年6月，DeFi借贷协议Compound开启流动性挖矿，不仅拉开了DeFi Summer的序幕，也给DeFi借贷赛道注入新活力、新思路、新用户，借贷业务成为DeFi的三大核心之一。

### 借贷协议的意义
借贷协议是DeFi的银行。传统银行中，用户可以向银行存款收取利息，也可以向银行借款，最后连本带利一起归还。类似的，在DeFi的借贷协议中用户可以向协议存钱、借钱，不同的是没有了中心化的托管机构，而是用户和借贷协议的智能合约直接交互，靠代码的运行确保一切有条不紊地进行。CeFi中的借贷，贷款担保方式分为信用、保证以及抵押贷款。尽管银行的风险偏好较低，抵押贷款在各类贷款中占比仍是最高的，但是得益于大数据信用体系建设，信用借贷越来越普遍，不过需要大量的审查、资质证明等。而DeFi中的借贷是匿名的，无需信任的，从模式上讲基本都处于抵押贷款方式，普遍采用的方式是超额抵押。也就是说，我抵押200块的资产，可以从你这借走不足200块的资金，这样你就无需担心我借钱跑路，可以放心地借钱给我了。这种以币借币，甚至越借越少的行为看似非常愚蠢，但是实际上它是存在切实需求的：
1. 交易活动的需求：包括套利、杠杆、做市等交易活动
例如做市商需要借资金来满足大量的交易；在DEX上买币只能做多，但是通过借币可以做空；通过抵押资产加杠杆，甚至可以通过循环贷不断增加杠杆（抵押ETH借USDC买ETH再抵押再借再买…）
2. 获得被动收入：闲置资金/屯币党在屯币的过程中可以通过借出资产获得额外收益
3. 代币激励：除了流动性挖矿，头部 DeFi 协议推出基于其原生代币的质押服务，代币持有者可质押获得更多原生代币。代币激励是面对借贷协议所有参与者的，借方可以通过交互获得代币奖励，通过交易获得的代币，偿还一部分债务。

相比传统房车类型抵押贷款，需要人力验证资产所有人，还款违约还需要人力及时间进行资产拍卖。DeFi中的当铺模式只需要在抵押率过低停止抵押，对资产清算即可结束贷款合同。

### 借贷协议的运作模式
加密资产的价格浮动往往会比较剧烈，借贷协议采用的超额抵押方式有助于避免资不抵债的情况发生，如下图所示：不同的抵押率对应不同的费率和质押要求。


![](images/2.png)

但是当极端情况来临，借贷协议会发生什么呢？比如现在ETH价格是1000 usd，我通过质押1个ETH借出800 usdc，突然ETH价格暴跌，这时候借贷协议要如何避免坏账呢？答案是清算。
我们以AAVE为例，看借贷协议是如何进行清算的。
首先介绍一个概念叫健康因子（Health Factor），健康因子是和账户的抵押物、借款金额有关。如何计算健康因子？1、查看抵押物的清算线（LiquidationThreshold），比如这次USDC是0.89（图一）；
2、健康因子 = 抵押金额 * 清算线/ 借出资产，以此刻（图二）为例，5794 * 0.89/ 4929 = 1.046 ；

注：LTV（Loan to Value）为最大可借比例，比如USDC的LTV为0.87，那么图二示例最大可借出 5794 * 0.87 = 5040

3、如果抵押物价格下跌，或者借出资产价格上涨，导致健康因子<1，则会执行清算Liquidation，具体清算过程如下（图三）

那么实际的不等式是：借出资产金额 <= 抵押金额 * LTV < 抵押金额 * 清算线。
清算时，超出清算线的部分会拿去拍卖，清算者（liquidators）购买抵押物，拍卖获得的资金用于归还负债，多出部分就作为清算者的奖赏。
清算过程依赖于预言机的喂价，目前AAVE取的是Chainlink 

简单总结，大部分的借贷协议目前采用的方式是超额抵押，当价格波动时由健康因子监控是否需要清算，以及清算多少。这里我们只讲了最简单最基本的借贷业务，实际上各个协议之间也各有特色，如Compound是去中心化的点对点模式，Compound的资金池运用模式使池内资金达到了极高的利用值，同时点对点加超额抵押使借款方可以在市场中进行没有尽头的资金循环（资金池永不枯竭）；AAVE首先提出了闪电贷，若资金和费用确认归还至资金池内则执行操作成功，若归还少于借出资金则还原交易，使交易制定者与存款方毫无风险便可做到无抵押贷款性质。


## 重点关注指标
搞明白链上借贷协议的业务逻辑之后，就可以着手分析了，接下来我将列出一些常用于评估借贷协议的一些指标。

## 常用表说明


## NFT综合看板示例

## 参考
https://twitter.com/0xhiger/status/1595076528697905157

## SixDegreeLab介绍

SixDegreeLab（[@SixdegreeLab](https://twitter.com/sixdegreelab)）是专业的链上数据团队，我们的使命是为用户提供准确的链上数据图表、分析以及洞见，并致力于普及链上数据分析。通过建立社区、编写教程等方式，培养链上数据分析师，输出有价值的分析内容，推动社区构建区块链的数据层，为未来广阔的区块链数据应用培养人才。

欢迎访问[SixDegreeLab的Dune主页](https://dune.com/sixdegree)。

因水平所限，不足之处在所难免。如有发现任何错误，敬请指正。
